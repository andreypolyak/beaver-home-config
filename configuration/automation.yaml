- alias: Watchdog
  trigger:
    platform: time_pattern
    minutes: /1
  action:
    - service: shell_command.watchdog

- alias: Notify on Restart
  initial_state: true
  trigger:
    platform: homeassistant
    event: start
  action:
    service: notify.mobile_app_andrey_iphone_11_pro_max
    data:
      message: "üè† Home Assistant was successfully restarted"
      data:
        push:
          sound: none
        apns_headers:
          apns-collapse-id: restart

- alias: Motioneye Entrance Door Camera Motion Started
  trigger:
    platform: webhook
    webhook_id: motioneye-entrance-door-camera-started
  action:
    service: input_boolean.turn_on
    data:
      entity_id: input_boolean.entrance_door_camera_motion_detected

- alias: Motioneye Entrance Door Camera Motion Ended
  trigger:
    platform: webhook
    webhook_id: motioneye-entrance-door-camera-ended
  action:
    service: input_boolean.turn_off
    data:
      entity_id: input_boolean.entrance_door_camera_motion_detected

- alias: Scan until Motion Ends
  trigger:
    - platform: state
      entity_id: binary_sensor.entrance_door_camera_motion
      to: "on"
  mode: single
  action:
    - repeat:
        sequence:
          - service: image_processing.scan
            target:
              entity_id: image_processing.entrance_door_camera
        until:
          - condition: state
            entity_id: binary_sensor.entrance_door_camera_motion
            state: "off"
