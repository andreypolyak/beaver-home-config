party_lights:
  sequence:
    - repeat:
        while:
        - condition: state
          entity_id: input_boolean.party_lights
          state: "on"
        sequence:
        - service: script.set_random_light_color
          data:
            light_entity: light.living_room_speaker_1
        - delay:
            milliseconds: 1000
        - service: script.set_random_light_color
          data:
            light_entity: light.living_room_speaker_2
        - delay:
            milliseconds: 1000

set_random_light_color:
  sequence:
    - condition: state
      entity_id: input_boolean.party_lights
      state: "on"
    - service: light.turn_on
      data_template:
        entity_id: "{{ light_entity }}"
        hs_color:
          - "{{ range(360)|random }}"
          - "{{ range(80, 101)|random }}"
        brightness: 127

party_tv_start:
  sequence:
    - service: switch.turn_on
      data:
        entity_id: switch.ir_tv_sources
    - service: remote.send_command
      data:
        entity_id: remote.living_room_apple_tv
        command: home
    - delay:
        milliseconds: 2000
    - repeat:
        count: 9
        sequence:
          - service: switch.turn_on
            data:
              entity_id: switch.ir_tv_up
          - delay:
              milliseconds: 400
    - repeat:
        count: 8
        sequence:
          - service: switch.turn_on
            data:
              entity_id: switch.ir_tv_down
          - delay:
              milliseconds: 400
    - service: switch.turn_on
      data:
        entity_id: switch.ir_tv_ok
    - service: rest_command.party_tv_start

party_tv_stop:
  sequence:
    - service: script.turn_on
      data:
        entity_id: script.tv_source_mac_mini
    - service: switch.turn_on
      data:
        entity_id: switch.ir_tv_sources
    - delay:
        milliseconds: 1000
    - service: switch.turn_on
      data:
        entity_id: switch.ir_tv_up
    - service: switch.turn_on
      data:
        entity_id: switch.ir_tv_ok
    - service: rest_command.party_tv_stop

party_tv_start_and_turn_on_tv:
  sequence:
    - service: script.tv_turn_on
    - delay:
        milliseconds: 30000
    - service: script.party_tv_start

party_tv_stop_and_turn_off_tv:
  sequence:
    - service: script.party_tv_stop
    - delay:
        milliseconds: 2000
    - service: script.tv_turn_off
