party_lights:
  sequence:
    - repeat:
        while:
        - condition: and
          conditions:
            - condition: state
              entity_id: input_boolean.party_lights
              state: "on"
            # - condition: state
            #   entity_id: input_select.living_scene
            #   state: party
        sequence:
        # - service: script.set_random_light_color
        #   data:
        #     light_entity: light.living_room_top_1
        # - delay:
        #     milliseconds: 1000
        # - service: script.set_random_light_color
        #   data:
        #     light_entity: light.living_room_top_2
        # - delay:
        #     milliseconds: 1000
        # - service: script.set_random_light_color
        #   data:
        #     light_entity: light.living_room_top_3
        # - delay:
        #     milliseconds: 1000
        # - service: script.set_random_light_color
        #   data:
        #     light_entity: light.living_room_top_4
        # - delay:
        #     milliseconds: 1000
        # - service: script.set_random_light_color
        #   data:
        #     light_entity: light.living_room_sofa
        # - delay:
        #     milliseconds: 1000
        - service: script.set_random_light_color
          data:
            light_entity: light.living_room_speaker_1
        - delay:
            milliseconds: 1000
        - service: script.set_random_light_color
          data:
            light_entity: light.living_room_speaker_2
        - delay:
            milliseconds: 1000
        # - service: script.set_random_light_color
        #   data:
        #     light_entity: light.living_room_sofa_led_rgb

set_random_light_color:
  sequence:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.party_lights
          state: "on"
        # - condition: state
        #   entity_id: input_select.living_scene
        #   state: party
    - service: light.turn_on
      data_template:
        entity_id: "{{ light_entity }}"
        hs_color:
          - "{{ range(360)|random }}"
          - "{{ range(80, 101)|random }}"
        brightness: 127
        # transition: 0.2
        effect: channel_change
    # - delay:
    #     milliseconds: 1000

party_tv_start:
  sequence:
    # - service: script.turn_on
    #   data:
    #     entity_id: script.tv_source_mac_mini
    - service: remote.send_command
      data:
        entity_id: remote.broadlink_rm_mini_3_remote
        command: b64:JgCoAFMeDh4NEA8PKywODw8ODw8ODw4PDRAODw4QDRAdEAwSDh4ODw0QDQAKr1YgDCAODw4PKi4ODw4PDRAODw4PDREMEQwRDg8cEQ4QDh4ODw0QDgAKsVMgDR8ODw0QKy0NEA4PDg8OEA4PDg8ODw4PDg8eDw0RDh4NEQ4PDgAKrVYgDh4NEA4PLCwNEA0QDRAODw8PDg8ODw4PDg8dEA0RDh4NEQ8ODgANBQ==
    - service: remote.send_command
      data:
        entity_id: remote.living_room_apple_tv
        command: home
    - delay:
        milliseconds: 2000
    - service: remote.send_command
      data:
        entity_id: remote.broadlink_rm_mini_3_remote
        command: b64:JgBUAFIfDCANEA4PDh4bEQ0QDg8ODw4PDg8PDw8ODg8dHh0QDh4ODw4PDwAKrVcfDR8NEQ0QDxwcEA4QDg8NEA0QDRANEA0QDhAcHxwRDh4NEA0QDQANBQAAAAA=
        delay_secs: 0.4
        num_repeats: 9
    - service: remote.send_command
      data:
        entity_id: remote.broadlink_rm_mini_3_remote
        command: b64:JgBMAFEgDR8NEA4PLCwNEA4PDw4ODw4PDhAODw4PHR4cEQ0fDg8eAAq9Vh8NHw0RDBErLA4QDg8ODw4PDg8ODw4PDhAbIBwRDx0ODx0ADQUAAAAAAAAAAAAAAAA=
        delay_secs: 0.4
        num_repeats: 8
    - service: remote.send_command
      data:
        entity_id: remote.broadlink_rm_mini_3_remote
        command: b64:JgAqAFIgDCAMEQwRDR8cEA4PDg8ODw4PDg8ODw4PDhAdHh0QDhANHw0QDgANBQAAAAAAAAAAAAAAAAAA
    - service: rest_command.party_tv_start

party_tv_stop:
  sequence:
    # - service: script.turn_on
    #   data:
    #     entity_id: script.tv_source_apple_tv
    - service: script.turn_on
      data:
        entity_id: script.tv_source_mac_mini
    - service: remote.send_command
      data:
        entity_id: remote.broadlink_rm_mini_3_remote
        command: b64:JgCoAFMeDh4NEA8PKywODw8ODw8ODw4PDRAODw4QDRAdEAwSDh4ODw0QDQAKr1YgDCAODw4PKi4ODw4PDRAODw4PDREMEQwRDg8cEQ4QDh4ODw0QDgAKsVMgDR8ODw0QKy0NEA4PDg8OEA4PDg8ODw4PDg8eDw0RDh4NEQ4PDgAKrVYgDh4NEA4PLCwNEA0QDRAODw8PDg8ODw4PDg8dEA0RDh4NEQ8ODgANBQ==
    - delay:
        milliseconds: 1000
    - service: remote.send_command
      data:
        entity_id: remote.broadlink_rm_mini_3_remote
        command: b64:JgBUAFIfDCANEA4PDh4bEQ0QDg8ODw4PDg8PDw8ODg8dHh0QDh4ODw4PDwAKrVcfDR8NEQ0QDxwcEA4QDg8NEA0QDRANEA0QDhAcHxwRDh4NEA0QDQANBQAAAAA=
        delay_secs: 0.4
        num_repeats: 1
    - service: remote.send_command
      data:
        entity_id: remote.broadlink_rm_mini_3_remote
        command: b64:JgAqAFIgDCAMEQwRDR8cEA4PDg8ODw4PDg8ODw4PDhAdHh0QDhANHw0QDgANBQAAAAAAAAAAAAAAAAAA
    - service: rest_command.party_tv_stop

party_tv_start_and_turn_on_tv:
  sequence:
    - service: script.tv_turn_on
    - delay:
        milliseconds: 30000
    - service: script.party_tv_start

party_tv_stop_and_turn_off_tv:
  sequence:
    - service: script.party_tv_stop
    - delay:
        milliseconds: 2000
    - service: script.tv_turn_off
