window_device:
  template: base_icon
  triggers_update:
    - input_boolean.auto_window_kitchen
    - input_boolean.auto_window_bedroom
    - sensor.kitchen_window
    - sensor.bedroom_window
  icon: mdi:window-closed-variant
  hold_action:
    action: more-info
    haptic: success
  tap_action:
    action: call-service
    service: script.fire_custom_event
    service_data:
      custom_event_data: >
        [[[ return variables.room + "_window"; ]]]
      custom_event_data2: toggle
    haptic: success
  double_tap_action:
    action: call-service
    service: input_boolean.toggle
    service_data:
      entity_id: >
        [[[ return "input_boolean.auto_window_" + variables.room; ]]]
    haptic: success
  styles:
    custom_fields:
      position:
        - position: absolute
        - right: 8px
        - top: 4px
        - font-size: 12px
      auto:
        - position: absolute
        - left: 8px
        - top: 4px
        - font-size: 12px
  state:
    - value: >
        [[[ return states["sensor." + variables.room + "_window"].state != "STOPPED"; ]]]
      operator: template
      color: var(--paper-item-icon-active-color)
    - value: >
        [[[ return states["sensor." + variables.room + "_window"].state == "STOPPED"; ]]]
      operator: template
      color: var(--paper-card-background-color)
  custom_fields:
    position: >
      [[[ return Math.round(states["sensor." + variables.room + "_window_target_position"].state) + "%"; ]]]
    auto: >
      [[[
        if (states["input_boolean.auto_window_" + variables.room].state == "on") {
          return "";
        } else {
          return `<ha-icon icon="mdi:lock-outline" style="width: 14px; height: 14px;"></ha-icon>`;
        }
      ]]]
  variables:
    room: ""
